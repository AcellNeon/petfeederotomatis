<!DOCTYPE html>
<html>
<head>
  <title>Automatic Pet Feeder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', Helvetica, sans-serif;
      margin: 0;
      height: 100vh;
      background: linear-gradient(135deg, #1f1c2c, #928dab, #2c3e50, #bdc3c7);
      background-size: 400% 400%;
      animation: gradientFlow 15s ease infinite;
      color: white;
    }
    @keyframes gradientFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .sidebar {height:100%;width:250px;position:fixed;top:0;left:-250px;background:#111;transition:.4s;display:flex;flex-direction:column;justify-content:space-between;z-index:1000;}
    .sidebar.open{left:0;}
    .sidebar a{padding:12px 20px;text-decoration:none;font-size:16px;color:#f1f1f1;display:flex;align-items:center;gap:10px;transition:.2s;}
    .sidebar a:hover{background:#575757;}
    .toggle-btn{position:fixed;top:15px;left:15px;font-size:20px;background:#111;color:white;border:none;padding:10px 15px;cursor:pointer;border-radius:4px;z-index:1100;}
    .toggle-btn.hidden{display:none;}
    .main-content{margin-left:0;transition:.4s;padding:20px;display:flex;justify-content:center;align-items:center;height:100%;}
    .sidebar.open ~ .main-content{margin-left:250px;}
    .login-card{background:rgba(255,255,255,0.08);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.2);border-radius:15px;padding:30px;width:340px;text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.4);animation:fadeSlideIn .8s ease forwards;}
    h1,h2{color:white;}
    .action-btn{padding:12px 20px;font-size:16px;border:none;cursor:pointer;border-radius:8px;background:linear-gradient(135deg,#ff9a9e,#fbc2eb);color:white;margin:8px 0;width:100%;}
    .action-btn:hover{transform:scale(1.05);}
    .settings-box{position:fixed;bottom:80px;left:270px;background:rgba(0,0,0,0.9);color:white;padding:15px;border-radius:10px;display:none;flex-direction:column;gap:10px;box-shadow:0 4px 15px rgba(0,0,0,0.4);}
    .settings-box.show{display:flex;}
    .rotate{animation:spin .6s linear;}
    @keyframes spin{from{transform:rotate(0);}to{transform:rotate(360deg);}}
    #scheduleList{list-style:none;padding:0;}
    #scheduleList li{font-size:16px;background:rgba(255,255,255,0.15);color:#fff;padding:12px 15px;margin:10px 0;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.3);display:flex;justify-content:space-between;align-items:center;transition:.2s;}
    #scheduleList li:hover{transform:scale(1.05);}
    #scheduleList li i{margin-right:10px;color:#f1c40f;}
    .edit-btn{background:#3498db;color:white;margin-left:5px;padding:5px 10px;border:none;border-radius:6px;}
    .delete-btn{background:#e74c3c;color:white;margin-left:5px;padding:5px 10px;border:none;border-radius:6px;}
    .notification{position:fixed;top:-60px;left:50%;transform:translateX(-50%);background:#2ecc71;color:white;padding:15px 25px;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,0.3);transition:.5s;z-index:9999;}
    .notification.show{top:20px;}
    @keyframes fadeSlideIn{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
    /* Account button */
    .account-btn{position:fixed;top:15px;right:15px;background:rgba(255,255,255,0.1);backdrop-filter:blur(8px);border-radius:30px;padding:8px 15px;display:flex;align-items:center;gap:10px;color:white;font-size:14px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.3);z-index:1200;}
    .account-btn:hover{transform:scale(1.05);}
    .account-icon{width:32px;height:32px;border-radius:50%;}
  </style>
</head>
<body>
  <!-- Account Button -->
  <div id="accountBtn" class="account-btn">
    <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User" class="account-icon">
    <span id="accountInfo">Loading...</span>
  </div>

  <!-- Toggle Sidebar -->
  <button id="toggleBtn" class="toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>

  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <div class="top"><a href="#" onclick="closeSidebar()"><i class="fas fa-arrow-left"></i></a></div>
    <div class="menu">
      <a href="#" onclick="showSection('dashboard')"><i class="fas fa-home"></i> Dashboard</a>
      <a href="#" onclick="showSection('schedule')"><i class="fas fa-calendar-alt"></i> Jadwal</a>
      <a href="#" onclick="showSection('history')"><i class="fas fa-history"></i> Riwayat</a>
    </div>
    <div class="bottom">
      <a href="#" onclick="toggleSettings()"><i id="gearIcon" class="fas fa-cog"></i> Settings</a>
      <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
  </div>

  <!-- Settings Box -->
  <div class="settings-box" id="settingsBox">
    <button class="action-btn" onclick="setEnglish()">Switch to English</button>
    <button class="action-btn" onclick="setIndonesian()">Switch to Bahasa</button>
    <button class="action-btn" onclick="showCredits()">Credits</button>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification"></div>

  <!-- Konten utama -->
  <div class="main-content">
    <div id="dashboardSection" class="login-card">
      <h1 id="dashboardTitle">Kontrol Servo</h1>
      <button id="feedNowBtn" class="action-btn" onclick="sendCommand()">Kasih Makan Sekarang</button>
    </div>
    <div id="scheduleSection" class="login-card" style="display:none;">
      <h2 id="scheduleTitle">Jadwal Otomatis</h2>
      <input type="time" id="feedTime">
      <button id="addScheduleBtn" class="action-btn" onclick="addSchedule()">Tambah Jadwal</button>
      <ul id="scheduleList"></ul>
    </div>
    <div id="historySection" class="login-card" style="display:none;">
      <h2 id="historyTitle">Riwayat</h2>
      <ul id="historyList"></ul>
      <button id="clearHistoryBtn" class="action-btn" onclick="clearHistory()">Hapus Riwayat</button>
    </div>
  </div>

  <!-- Script UI -->
  <script>
    const apiKey = "09LPP2CN0H8VL1I2";
    const talkbackID = "56041";
    let schedules = [];
    let history = [];

        window.toggleSidebar = function(){
      document.getElementById("sidebar").classList.add("open");
      document.getElementById("toggleBtn").classList.add("hidden");
    };
    window.closeSidebar = function(){
      document.getElementById("sidebar").classList.remove("open");
      document.getElementById("toggleBtn").classList.remove("hidden");
    };
    window.showSection = function(section){
      document.getElementById("dashboardSection").style.display = "none";
      document.getElementById("scheduleSection").style.display = "none";
      document.getElementById("historySection").style.display = "none";
      if(section==="dashboard") document.getElementById("dashboardSection").style.display="block";
      if(section==="schedule") document.getElementById("scheduleSection").style.display="block";
      if(section==="history") document.getElementById("historySection").style.display="block";
      closeSidebar();
    };
    window.toggleSettings = function(){
      const box=document.getElementById("settingsBox");
      const gear=document.getElementById("gearIcon");
      box.classList.toggle("show");
      gear.classList.add("rotate");
      setTimeout(()=>gear.classList.remove("rotate"),600);
    };
    window.setEnglish = function(){ /* isi sama seperti sebelumnya */ };
    window.setIndonesian = function(){ /* isi sama seperti sebelumnya */ };
    window.showCredits = function(){ /* isi sama seperti sebelumnya */ };
    window.showNotification = function(message,color="#2ecc71"){ /* isi sama seperti sebelumnya */ };
    window.addHistory = function(action){ /* isi sama seperti sebelumnya */ };
    window.updateHistoryList = function(){ /* isi sama seperti sebelumnya */ };
    window.clearHistory = function(){ /* isi sama seperti sebelumnya */ };
    window.saveHistory = function(){ /* isi sama seperti sebelumnya */ };
    window.loadHistory = function(){ /* isi sama seperti sebelumnya */ };
    window.sendCommand = function(){ /* isi sama seperti sebelumnya */ };
    window.addSchedule = function(){ /* isi sama seperti sebelumnya */ };
    window.deleteSchedule = function(index){ /* isi sama seperti sebelumnya */ };
    window.editSchedule = function(index){ /* isi sama seperti sebelumnya */ };
    window.updateScheduleList = function(){ /* isi sama seperti sebelumnya */ };
    window.saveSchedules = function(){ /* isi sama seperti sebelumnya */ };
    window.loadSchedules = function(){ /* isi sama seperti sebelumnya */ };
    window.logout = function(){ /* isi sama seperti sebelumnya */ };
  </script>

  <!-- Script Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA-sLBXum9oj1mpDp7rPn4--q3LCBQtMnI",
      authDomain: "loginpage-e42a7.firebaseapp.com",
      databaseURL: "https://loginpage-e42a7-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "loginpage-e42a7",
      storageBucket: "loginpage-e42a7.firebasestorage.app",
      messagingSenderId: "535312484754",
      appId: "1:535312484754:web:273829b9dff1ae9715594b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.loadAccountInfo = function(){
      const userRef = ref(db,"users/currentUser");
      get(userRef).then(snapshot=>{
        if(snapshot.exists()){
          const data=snapshot.val();
          const username=data.username||"Anon";
          const type=data.type||"User";
          document.getElementById("accountInfo").textContent=`${username} (${type})`;
        } else {
          document.getElementById("accountInfo").textContent="Guest";
        }
      }).catch(err=>{
        console.error(err);
        document.getElementById("accountInfo").textContent="Error";
      });
    };

    // panggil saat halaman load
    window.addEventListener("load",()=>{
      loadSchedules();
      loadHistory();
      showSection("dashboard");
      loadAccountInfo();
    });
  </script>
</body>
</html>
