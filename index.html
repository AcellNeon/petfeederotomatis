<!DOCTYPE html>
<html>
<head>
  <title>Login Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
</head>
<body>
  <div class="container">
    <h1>Automatic Pet Feeder</h1>

    <div id="setPinDiv">
      <h2>Buat PIN Baru</h2>
      <input type="password" id="newPin" maxlength="4" placeholder="4 digit pin"><br>
      <button onclick="setPin()">Simpan PIN</button>
    </div>

    <div id="loginDiv" style="display:none;">
      <h2>Login dengan PIN</h2>
      <input type="password" id="pin" maxlength="4" placeholder="4 digit pin"><br>
      <button onclick="checkPin()">Login</button>
      <p id="status"></p>
      <button class="link-btn" onclick="forgotPin()">Lupa PIN?</button>
    </div>
  </div>

  <script>
    // ðŸ”§ Firebase Config (copy dari Firebase Console)
    const firebaseConfig = {
    apiKey: "AIzaSyA-sLBXum9oj1mpDp7rPn4--q3LCBQtMnI",
    authDomain: "loginpage-e42a7.firebaseapp.com",
    projectId: "loginpage-e42a7",
    storageBucket: "loginpage-e42a7.firebasestorage.app",
    messagingSenderId: "535312484754",
    appId: "1:535312484754:web:273829b9dff1ae9715594b"
  };

    // ðŸ”§ Inisialisasi Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function setPin() {
      const newPin = document.getElementById("newPin").value;
      if (newPin.length === 4) {
        db.ref("userPIN").set(newPin)  // simpan ke Firebase
          .then(() => {
            alert("PIN berhasil disimpan!");
            document.getElementById("setPinDiv").style.display = "none";
            document.getElementById("loginDiv").style.display = "block";
          })
          .catch(err => alert("Error: " + err));
      } else {
        alert("PIN harus 4 digit!");
      }
    }

    function checkPin() {
      const pin = document.getElementById("pin").value;
      db.ref("userPIN").get().then(snapshot => {
        if (snapshot.exists() && pin === snapshot.val()) {
          window.location.href = "feeder.html";
        } else {
          document.getElementById("status").innerText = "PIN salah!";
        }
      });
    }

    function forgotPin() {
      db.ref("userPIN").remove()
        .then(() => {
          alert("PIN direset. Silakan buat PIN baru.");
          document.getElementById("loginDiv").style.display = "none";
          document.getElementById("setPinDiv").style.display = "block";
        });
    }

    // ðŸ”§ Cek apakah PIN sudah ada di Firebase
    db.ref("userPIN").get().then(snapshot => {
      if (snapshot.exists()) {
        document.getElementById("setPinDiv").style.display = "none";
        document.getElementById("loginDiv").style.display = "block";
      }
    });
  </script>
</body>
</html>
